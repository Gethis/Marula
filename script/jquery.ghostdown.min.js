!function(e,t,a){"use strict";e.widget("b4m.ghostDown",{editor:null,markdown:null,html:null,converter:null,_create:function(){this.converter=new t.converter,this.editor=a.fromTextArea(this.element.find("textarea")[0],{mode:"markdown",tabMode:"indent",lineWrapping:!0}),this.editor.on("change",e.proxy(function(){this._updatePreview()},this)),e(".entry-markdown header, .entry-preview header",this.element).click(function(t){e(".entry-markdown, .entry-preview",this.element).removeClass("active"),e(t.target,this.element).closest("section").addClass("active")}),e(".CodeMirror-scroll",this.element).on("scroll",e.proxy(function(e){this._syncScroll(e)},this)),e(".CodeMirror-scroll",this.element).scroll(function(t){e(t.target).scrollTop()>10?e(".entry-markdown",this.element).addClass("scrolling"):e(".entry-markdown",this.element).removeClass("scrolling")}),e(".entry-preview-content",this.element).scroll(function(t){e(".entry-preview-content",e(t.target).scrollTop()).scrollTop()>10?e(".entry-preview",this.element).addClass("scrolling"):e(".entry-preview",this.element).removeClass("scrolling")}),this._updatePreview()},_updatePreview:function(){var e=this.element.find(".rendered-markdown");this.markdown=this.editor.getValue(),this.html=this.converter.makeHtml(this.markdown),e.html(this.html),this._updateWordCount()},getHtml:function(){return this.html},getMarkdown:function(){return this.markdown},_syncScroll:function(t){var a=e(t.target),n=e(".entry-preview-content"),r=e(".CodeMirror-sizer"),o=e(".rendered-markdown"),i=r.height()-a.height(),s=o.height()-n.height(),l=s/i,d=a.scrollTop()*l;n.scrollTop(d)},_updateWordCount:function(){var e=this.element.find(".entry-word-count"),t=this.markdown;t.length&&e.html(t.match(/\S+/g).length+" words")}})}(jQuery,Showdown,CodeMirror);